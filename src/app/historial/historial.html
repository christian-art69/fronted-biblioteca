<div class="gestion-container">
  <div class="card">
    <div class="card-header">
      <h2>
        {{ authService.role() === 'Admin' ? 'Historial de Préstamos (Todos)' : 'Mi Historial de Préstamos' }}
      </h2>
    </div>
    
    <div class="card-body">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th *ngIf="authService.role() === 'Admin'">Usuario</th>
              <th *ngIf="authService.role() === 'Admin'">RUT</th>
              <th>Libro</th>
              <th>Autor</th>
              <th>Fecha Préstamo</th>
              <th>Fecha Límite</th> 
              <th>Fecha Devolución Real</th> 
              <th>Estado Entrega</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let h of historial">
              <td *ngIf="authService.role() === 'Admin'">{{ h.usuario.nombre }}</td>
              <td *ngIf="authService.role() === 'Admin'">{{ h.usuario.rut }}</td>
              <td>{{ h.libro.titulo }}</td>
              <td>{{ h.libro.autor }}</td>
              <td>{{ h.fechaPrestamo | date: 'dd/MM/yyyy' }}</td>
              <td>{{ h.fechaDevolucionLimite | date: 'dd/MM/yyyy' }}</td>
              <td>{{ h.fechaDevolucionReal | date: 'dd/MM/yyyy' }}</td>
              <td>
                <span class="user-status" 
                      [style.background-color]="h.estadoEntrega === 'Atrasado' ? 'var(--color-error)' : 'var(--color-exito)'">
                  {{ h.estadoEntrega }}
                </span>
              </td>
            </tr>
            <tr *ngIf="historial.length === 0">
              <td [attr.colspan]="authService.role() === 'Admin' ? 8 : 6" style="text-align: center;">
                No hay registros en el historial.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>